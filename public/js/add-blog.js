(()=>{const e=document.querySelector("meta[name=csrf-token]").getAttribute("content"),t=document.querySelector("form");class o{constructor(e){this.loader=e}upload(){return this.loader.file.then((e=>new Promise(((t,o)=>{this._initRequest(),this._initListeners(t,o,e),this._sendRequest(e)}))))}abort(){this.xhr&&this.xhr.abort()}_initRequest(){const t=this.xhr=new XMLHttpRequest;t.open("POST","http://localhost:3000/blog/image/upload",!0),t.setRequestHeader("CSRF-Token",e),t.responseType="json"}_initListeners(e,t,o){const a=this.xhr,n=this.loader,r=`Couldn't upload file: ${o.name}.`;a.addEventListener("error",(()=>t(r))),a.addEventListener("abort",(()=>t())),a.addEventListener("load",(()=>{const o=a.response;if(!o||o.error)return t(o&&o.error?o.error.message:r);e({default:o.url})})),a.upload&&a.upload.addEventListener("progress",(e=>{e.lengthComputable&&(n.uploadTotal=e.total,n.uploaded=e.loaded)}))}_sendRequest(e){const t=new FormData;t.append("blogImg",e),this.xhr.send(t)}}let a;ClassicEditor.create(document.querySelector("#ckeditor"),{language:"fa",heading:{options:[{model:"paragraph",title:"پاراگراف",class:"ck-heading_paragraph"},{model:"heading1",view:"h1",title:"تیتر نویس 1",class:"ck-heading_heading1"},{model:"heading2",view:"h2",title:"تیتر نویس 2",class:"ck-heading_heading2"},{model:"heading3",view:"h3",title:"تیتر نویس 3",class:"ck-heading_heading3"},{model:"heading4",view:"h4",title:"تیتر نویس 4",class:"ck-heading_heading3"},{model:"heading5",view:"h5",title:"تیتر نویس 5",class:"ck-heading_heading3"},{model:"heading6",view:"h6",title:"تیتر نویس 6",class:"ck-heading_heading3"}]},extraPlugins:[function(e){e.plugins.get("FileRepository").createUploadAdapter=e=>new o(e)}],toolbar:{items:["heading","|","bold","italic","link","|","fontSize","fontColor","|","imageUpload","blockQuote","insertTable","undo","redo","codeBlock"]},table:{contentToolbar:["tableColumn","tableRow","mergeTableCells"]},simpleUpload:{uploadUrl:"/blog/blogImg",headers:{"CSRF-Token":e}}}).then((e=>{a=e})).catch((e=>{console.error(e)})),t.addEventListener("submit",(e=>{const t=document.querySelector("form [name=title]"),o=document.querySelector("form [name=category]"),n=document.querySelector("form [name=blogImg]"),r=document.querySelector("form [name=tags]"),s=document.querySelector("form [name=description]"),i=a.data.get(),l=(new FastestValidator).compile({title:{type:"string",empty:!1,messages:{stringEmpty:"تیتر پست الزامی است!"}},category:{type:"string",empty:!1,messages:{stringEmpty:"دسته بندی پست الزامی است!"}},blogImg:{type:"string",empty:!1,messages:{stringEmpty:"تصویر پست الزامی است!"}},tags:{type:"array",items:"string",unique:!0,min:2,messages:{arrayMin:"حدااقل 2 تگ الزامی است!",arrayUnique:"تگ ها باید متفاوت باشند!"}},description:{type:"string",min:20,messages:{stringMin:"دسکریپشن حدااقل 20 کاراکتر باشد!",stringMax:"دسکریپشن حدااکثر 50 کاراکتر باشد!"}},body:{type:"string",min:200,messages:{stringMin:"متن پست حدااقل 200 کاراکتر باشد!"}}})({title:t.value,category:o.value,blogImg:n.value,tags:r.value.split("/").filter((e=>0!==e.length)),description:s.value,body:i});document.querySelectorAll(".invalid-feedback").forEach((e=>e.remove())),document.querySelectorAll("form .form-control").forEach((e=>e.classList.remove("border-danger"))),console.log(l),!0!==l&&(e.preventDefault(),l.forEach((e=>{const t=document.querySelector(`form [name=${e.field}]`);t.classList.add("border-danger");const o=(e=>{const t=document.createElement("div");return t.classList="invalid-feedback d-block w-100 font-medium",t.textContent=e,t})(e.message);t.closest("div").appendChild(o)})))}))})();