(()=>{const e=document.querySelector("#addCommentCkeditor"),t=document.querySelector("#editComment textarea"),o=document.querySelector("#replyCommentCkeditor"),n=document.querySelector("#editComment"),c=document.querySelector(".like-blog"),a=document.querySelector(".likes .like-number"),s=document.querySelectorAll("button.add-comment"),r={language:"fa",heading:{options:[{model:"paragraph",title:"پاراگراف",class:"ck-heading_paragraph"},{model:"heading1",view:"h1",title:"تیتر نویس 1",class:"ck-heading_heading1"},{model:"heading2",view:"h2",title:"تیتر نویس 2",class:"ck-heading_heading2"},{model:"heading3",view:"h3",title:"تیتر نویس 3",class:"ck-heading_heading3"},{model:"heading4",view:"h4",title:"تیتر نویس 4",class:"ck-heading_heading3"},{model:"heading5",view:"h5",title:"تیتر نویس 5",class:"ck-heading_heading3"},{model:"heading6",view:"h6",title:"تیتر نویس 6",class:"ck-heading_heading3"}]}};let l;ClassicEditor.create(t,r).then((e=>l=e)).catch((e=>console.log(e))),ClassicEditor.create(e,r).then((e=>console.log(e))).catch((e=>console.log(e))),ClassicEditor.create(o,r).then((e=>console.log(e))).catch((e=>console.log(e)));const i=()=>{const e=document.createElement("span");return e.classList="spinner-border spinner-border-sm ms-1",e},m=async e=>{e.target.append(i())},d=e=>{Swal.fire({title:"از انجام این کار مطمئنی؟",text:"مطمئنی که میخوای پاکش کنی؟",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"آره، مطمئنم",cancelButtonText:"نه، لغو عملیات"}).then((async t=>{if(t.isConfirmed){const t=document.querySelector("meta[name=csrfToken]").getAttribute("content"),{commentId:o}=e.target.closest("button").dataset;e.target.append(i());const n=await fetch("http://localhost:3000/comment/delete",{method:"DELETE",body:JSON.stringify({commentId:o}),headers:{"Content-Type":"application/json","CSRF-Token":t,"X-Requested-With":"XMLHttpRequest"}});if(200===n.status){const e=await n.json();console.log(e),y(),Swal.fire({titleText:"مــــوفــــق!",text:e.message,footer:"هنرستان خوارزمی فیروزآباد",icon:"success",timer:4e3,timerProgressBar:!0,showConfirmButton:!1})}else{const e=await n.json();Swal.fire({titleText:"خــطــا!",text:e.message,footer:"هنرستان خوارزمی فیروزآباد",icon:"error",timer:3e3,timerProgressBar:!0,showConfirmButton:!1})}}}))},u=async e=>{Swal.fire({title:"از انجام این کار مطمئنی؟",text:"مطمئنی که میخوای پاکش کنی؟",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"آره، مطمئنم",cancelButtonText:"نه، لغو عملیات"}).then((async t=>{if(t.isConfirmed){const{commentId:t,replyId:o}=e.target.closest("button").dataset,n=document.querySelector("meta[name=csrfToken]").getAttribute("content");e.target.append(i());const c=await fetch("http://localhost:3000/comment/delete",{method:"DELETE",body:JSON.stringify({replyId:o,commentId:t,replyComment:!0}),headers:{"Content-Type":"application/json","CSRF-Token":n,"X-Requested-With":"XMLHttpRequest"}});if(200===c.status){const t=await c.json();e.target.closest("li").remove(),Swal.fire({titleText:"مــوفــق!",text:t.message,footer:"هنرستان خوارزمی فیروزآباد",icon:"success",timer:3e3,timerProgressBar:!0,showConfirmButton:!1})}else{const e=await c.json();Swal.fire({titleText:"خــطــا!",text:e.message,footer:"هنرستان خوارزمی فیروزآباد",icon:"error",timer:3e3,timerProgressBar:!0,showConfirmButton:!1})}}}))},h=e=>{const{commentId:t,replyId:o}=e.target.closest("button").dataset;document.querySelector("#editComment input[name=commentId]").value=t,o&&(document.querySelector("#editComment input[name=replyId]").value=o)},g=e=>{const{commentId:t}=e.target.closest("button").dataset;document.querySelector("#replyComment input[name=replyId]").value=t},p=e=>{e.target.append(i())};let f=1;const y=async()=>{const e=window.location.pathname.split("/")[3],t=await fetch(`http://localhost:3000/comment/${e}?slide=${f}`,{headers:{"X-Requested-With":"XMLHttpRequest"}});if(200===t.status){const e=await t.json(),o=document.querySelector(".comments-area .comments"),n=new DOMParser;if(o.innerHTML="",e.commentsLength>=1){const t=n.parseFromString(e.commentsUI,"text/html").querySelector("ul");if(o.append(t),e.commentsPerPage*f<e.commentsLength){const e=document.createElement("button");e.classList="btn btn-secondary mb-4 d-block",e.id="paginate-comments",e.textContent="خواندن کامنت های بیشتر...",o.append(e),e.addEventListener("click",(()=>{f+=1,y()}))}const c=document.querySelectorAll(".reply-comment"),a=document.querySelectorAll(".delete-comment"),s=document.querySelectorAll(".delete-reply-comment"),r=document.querySelector(".edit-comment"),l=document.querySelectorAll(".edit-comment-modal-opener");a.forEach((e=>e.addEventListener("click",d))),s.forEach((e=>e.addEventListener("click",u))),r.addEventListener("click",p),l.forEach((e=>e.addEventListener("click",h))),c.forEach((e=>e.addEventListener("click",g))),[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')).map((function(e){return new bootstrap.Tooltip(e)}))}else{const t=n.parseFromString(e.commentsUI,"text/html").querySelector("div");o.append(t)}document.querySelector(".blog-feedbacks .comments span").textContent=e.commentsLength}else console.log("Something went wrong!")};document.addEventListener("DOMContentLoaded",y),c.addEventListener("click",(async()=>{const{blogId:e}=c.dataset,t=await fetch(`http://localhost:3000/blog/like/${e}`,{headers:{"X-Requested-With":"XMLHttpRequest"}});if(200===t.status){const e=await t.json();a.textContent=e.blogLikesLength,c.classList.contains("liked")?c.classList.remove("liked"):c.classList.add("liked")}else 401===t.status?Swal.fire({titleText:"خــطــا!",text:"لطفا ابتدا وارد حساب کاربری خود شوید",footer:"هنرستان خوارزمی فیروزآباد",icon:"error",timer:3e3,timerProgressBar:!0,showConfirmButton:!1}):Swal.fire({titleText:"خــطــا!",text:"مشکلی پیش آمده، لطفا دوباره تلاش کنید!",footer:"هنرستان خوارزمی فیروزآباد",icon:"error",timer:3e3,timerProgressBar:!0,showConfirmButton:!1})})),n.addEventListener("shown.bs.modal",(async()=>{const e=document.querySelector("#editComment input[name=commentId]"),t=document.querySelector("#editComment input[name=replyId]");let o;o=t.value?`http://localhost:3000/comment/read/${e.value}?replyId=${t.value}`:`http://localhost:3000/comment/read/${e.value}`;const n=await fetch(o,{headers:{"X-Requested-With":"XMLHttpRequest"}});if(200===n.status){const e=await n.json();l.setData(e.comment.comment)}else{const e=await n.json();console.log(e)}})),n.addEventListener("hidden.bs.modal",(()=>{n.querySelector("input[name=replyId]").value=""})),s.forEach((e=>e.addEventListener("click",m)))})();